import streamlit as st
import sqlite3
import os

# Path to the database
db_path = os.path.join(os.path.dirname(__file__), '../data/devices.db')

# Connect to the database and fetch device details
def get_devices_from_db():
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM devices")
    devices = cursor.fetchall()
    conn.close()
    return devices

def show_device_details_page():
    st.title("Device Details")

    devices = get_devices_from_db()

    if devices:
        # Display the number of devices
        st.write(f"Total number of devices: {len(devices)}")
        
        for device in devices:
            with st.expander(f"Device: {device[4]} - {device[3]}"):
                st.json({
                    "ID": device[0],
                    "IP Address": device[1],
                    "MAC Address": device[2],
                    "Manufacturer": device[3],
                    "Device Type": device[4],
                    "OS": device[5],
                    "Ports": device[6],
                    "Protocols": device[7],
                    "Services": device[8],
                    "Versions": device[9]
                })
                # Add the "View Vulnerabilities" button (dummy for now)
                if st.button("View Vulnerabilities", key=f"vuln_{device[0]}"):
                    st.write("This will display vulnerabilities related to this device.")
    else:
        st.warning("No device data available. Please run a scan first.")
